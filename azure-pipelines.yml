trigger:
- azure-pipelines

jobs:
- job: Linux
  pool:
   vmImage: "ubuntu-16.04"
  strategy:
    matrix:
      production:
        btorConfig: ""
      debug:
        btorConfig: "-g"
      python2:
        needCython: true
        btorConfig: "--python --py2"
      python3:
        needCython: true
        btorConfig: "--python --py3"

  steps:
  - script: sudo pip install -U cython
    condition: eq('$(needCython)', 'true')

  - script: |
      ./contrib/setup-btor2tools.sh
      ./contrib/setup-cadical.sh
      ./contrib/setup-lingeling.sh
    displayName: 'Setup dependencies'

  - script: ./configure.sh $(btorConfig)
    displayName: 'Configure Boolector'

  - script: make -j $(nproc)
    workingDirectory: "build"
    displayName: 'Build Boolector'

  - script: ctest -j$(nproc) --output-on-failure
    workingDirectory: "build"
    displayName: 'Run tests'

  #strategy:
  #  matrix:
  #    linux_opt:
  #      imageName: "ubuntu-16.04"
  #      btorConfig: ""
  #    linux_debug:
  #      imageName: "ubuntu-16.04"
  #      btorConfig: "-g"
  #    linux_py2:
  #      imageName: "ubuntu-16.04"
  #      btorConfig: "--python --py2"
  #    linux_py3:
  #      imageName: "ubuntu-16.04"
  #      btorConfig: "--python --py3"
  #    mac_opt:
  #      imageName: "macos-10.13"
  #      btorConfig: ""
  #    mac_debug:
  #      imageName: "macos-10.13"
  #      btorConfig: "-g"
  #    mac_py2:
  #      imageName: "macos-10.13"
  #      btorConfig: "--python --py2"
  #    mac_py3:
  #      imageName: "macos-10.13"
  #      btorConfig: "--python --py3"
  #
  #pool:
  #  vmImage: $(imageName)
  #
  #steps:
  #- script: |
  #    ./contrib/setup-btor2tools.sh
  #    ./contrib/setup-cadical.sh
  #    ./contrib/setup-lingeling.sh
  #  displayName: 'Setup dependencies'
  #
  #- script: ./configure.sh $(btorConfig)
  #  displayName: 'Configure Boolector'
  #
  #- script: make -j $(nproc)
  #  workingDirectory: "build"
  #  displayName: 'Build Boolector'
  #
  #- script: ctest -j$(nproc) --output-on-failure
  #  workingDirectory: "build"
  #  displayName: 'Run tests'
