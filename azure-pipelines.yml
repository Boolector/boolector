trigger:
- azure-pipelines

strategy:
  matrix:
    linux_opt:
      imageName: "ubuntu-16.04"
      btorConfig: ""
    linux_debug:
      imageName: "ubuntu-16.04"
      btorConfig: "-g"
    linux_py:
      imageName: "ubuntu-16.04"
      btorConfig: "--python"
    mac_opt:
      imageName: "macos-10.13"
      btorConfig: ""
    mac_debug:
      imageName: "macos-10.13"
      btorConfig: "-g"
    mac_py:
      imageName: "macos-10.13"
      btorConfig: "--python"


pool:
  vmImage: $(imageName)

steps:
- script: |
    ./contrib/setup-btor2tools.sh
    ./contrib/setup-cadical.sh
    ./contrib/setup-lingeling.sh
  displayName: 'Setup dependencies'

- script: ./configure.sh $(btorConfig)
  displayName: 'Configure Boolector'

- script: |
    cd build
    echo $(nproc)
    make -j $(nproc)
  displayName: 'Build Boolector'

- script: bin/test #ctest -j$(nproc)
  displayName: 'Run tests'
