trigger:
- master

variables:
  CCACHE_DIR: $(Pipeline.Workspace)/ccache

jobs:
- job: Linux
  pool:
   vmImage: 'ubuntu-16.04'
  steps:
  - script: |
      apt-get install python3.6 -y
      pip3.6 install wheel
      pip3.6 install twine
    displayName: 'Install wheel+twine'
  - script: |
      docker pull quay.io/pypa/manylinux1_x86_64
      docker build -t pyboolector pypi
    displayName: 'Setup Docker Image'

  - script: |
      docker run -v $(Build.Repository.LocalPath):/boolector pyboolector
    displayName: 'Run PyBoolector Build'

  - task: TwineAuthenticate@1
    inputs:
      pythonUploadServiceConnection: pypi
  - script: |
      ls result
      echo "Python version:"
      python3.6 --version
      echo "Twine version:"
      python3.6 -m twine --version

      echo "PYPIRC_PATH: $(PYPIRC_PATH)"
      cat $(PYPIRC_PATH)
      python3.6 -m twine upload -r "pypi" --config-file $(PYPIRC_PATH) result/wheelhouse/* result/dist/*.tar.gz
    displayName: 'Upload to PyPi'
